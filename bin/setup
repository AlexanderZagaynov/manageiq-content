#!/usr/bin/env ruby
require 'pathname'

GEM_ROOT = Pathname.new(__dir__).join("..")

Dir.chdir(GEM_ROOT) do
  if File.exist?("spec/manageiq")
    puts "== Updating manageiq sample app =="
    system "cd spec/manageiq && git pull"
  else
    puts "== Cloning manageiq sample app =="
    source = ENV["CI"] ? "https://github.com/ManageIQ/manageiq.git" : "git@github.com:ManageIQ/manageiq.git"
    system "git clone #{source} --depth 1 spec/manageiq"
  end

  require GEM_ROOT.join("spec/manageiq/lib/manageiq/environment").to_s
  ManageIQ::Environment.manageiq_plugin_setup
end
